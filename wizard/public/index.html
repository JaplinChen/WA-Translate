<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WA 翻譯設定精靈</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <div class="wrap">
    <h1>WA 翻譯設定精靈</h1>
    <p class="sub">只要按這三個按鈕：連線、選群組、啟用翻譯。</p>

    <section class="card quick-card">
      <h2>三步完成</h2>
      <div class="quick-actions">
        <button id="quickConnect" class="quick-btn" type="button">1. 連線 WhatsApp</button>
        <button id="quickGroups" class="quick-btn ghost" type="button">2. 選擇群組</button>
        <button id="quickEnable" class="quick-btn" type="button">3. 啟用翻譯</button>
      </div>
      <div id="quickStatus" class="status">先按「1. 連線 WhatsApp」。</div>
    </section>

    <section class="card wizard-panel active" id="section-connect">
      <h2>1) 連線 WhatsApp</h2>
      <p class="note">手機請走這個路徑：WhatsApp（手機）→ 設定 → 已連結裝置 → + 連結一部裝置，然後掃描此頁 QR（不要掃「我的聯絡人 QR」）。</p>
      <div class="buttons">
        <button id="startWa" type="button">啟動 WhatsApp 連線</button>
        <button id="refreshGroups" class="ghost" type="button">刷新群組</button>
      </div>
      <div id="waStatus" class="status">尚未啟動</div>
      <img id="waQr" class="qr" style="display:none;" alt="WA QR" />
      <input id="waAdmin" type="hidden" />
    </section>

    <section class="card wizard-panel active" id="section-group">
      <h2>2) 選擇群組</h2>
      <p class="note">請從下方群組清單按「使用」，系統會自動帶入目標群組。</p>
      <div id="selectedGroupStatus" class="status">尚未選擇群組</div>
      <input id="groupSearch" type="text" placeholder="搜尋群組名稱或 ID" />
      <input id="waGroup" type="hidden" />
      <div id="groupList" class="groups"></div>
    </section>

    <section class="card wizard-panel active" id="section-pairs">
      <h2>3) 翻譯模式</h2>
      <p class="note">一般只要選一個快速組合即可。</p>
      <div class="preset-row">
        <button id="presetZhVi" class="ghost" type="button">快速加入：中↔越</button>
        <button id="presetZhEn" class="ghost" type="button">快速加入：中↔英</button>
      </div>
      <p id="pairValidation" class="note note-warn" style="display:none;"></p>
      <div class="pair-panel">
        <div class="pair-panel-title">已啟用語言對</div>
        <div class="pairs" id="pairList"></div>
      </div>
      <details id="advancedPairs" class="advanced-block">
        <summary>進階設定（語言細節）</summary>
        <p class="note">來源與目標語言需不同，至少一組方向。</p>
        <div class="mode-row">
          <select id="pairSrc">
            <option value="zh-tw">中文（繁體） (zh-tw)</option>
            <option value="vi" selected>越文 (vi)</option>
            <option value="en">英文 (en)</option>
            <option value="ja">日文 (ja)</option>
            <option value="ko">韓文 (ko)</option>
            <option value="th">泰文 (th)</option>
          </select>
          <div class="arrow">→</div>
          <select id="pairDst">
            <option value="zh-tw" selected>中文（繁體） (zh-tw)</option>
            <option value="vi">越文 (vi)</option>
            <option value="en">英文 (en)</option>
            <option value="ja">日文 (ja)</option>
            <option value="ko">韓文 (ko)</option>
            <option value="th">泰文 (th)</option>
          </select>
          <button id="addPair" type="button">加入翻譯方向</button>
        </div>
        <div class="preset-row">
          <button id="clearPairs" class="ghost warn" type="button">清空語言對</button>
        </div>
        <div class="row row-pad row-single">
          <label class="checkbox-label">
            <input id="includeFromMe" type="checkbox" checked />
            翻譯自己發出的訊息
          </label>
        </div>
      </details>
    </section>

    <section class="card wizard-panel active" id="section-apply">
      <h2>4) 套用設定</h2>
      <p class="note">一般只要按「儲存並套用」，系統會自動套用到 BOT。</p>
      <div id="applyConfig">
        <div class="buttons">
          <button id="save" type="button">儲存並套用</button>
        </div>
        <details id="advancedApply" class="advanced-block">
          <summary>進階設定（API key / Session）</summary>
          <p class="note">若已設定過 API key，可留空沿用。</p>
          <div class="row">
            <input id="gemini" type="password" placeholder="留空表示沿用現有 GEMINI_API_KEYS" autocomplete="off" />
            <button class="ghost" id="openGemini" type="button">開啟 AI Studio</button>
          </div>
          <p id="geminiHint" class="note">為安全起見，不會顯示既有 API key 明文。</p>
          <div class="row">
            <input id="sessionId" type="text" placeholder="WHATSAPP_SESSION_CLIENT_ID（預設 wa-translate）" />
          </div>
        </details>
      </div>
      <div id="applySummary" class="status" style="display:none;"></div>
      <div id="applyDoneActions" class="buttons" style="display:none;">
        <button id="editAgain" class="ghost" type="button">修改設定</button>
      </div>
      <div id="saveMsg" class="status" style="display:none;"></div>
    </section>
  </div>

  <script src="/pair-manager.js" defer></script>
  <script src="/app.js" defer></script>
</body>
</html>
